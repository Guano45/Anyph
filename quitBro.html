<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuitBro - Addiction Recovery Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #1a1a2e;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 400px;
            width: 100%;
            background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            background-color: #0f3460;
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #e94560;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #e94560;
            letter-spacing: 1px;
        }
        
        .timer-section {
            padding: 25px 20px;
            text-align: center;
            background-color: rgba(15, 52, 96, 0.7);
        }
        
        .timer {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        
        .time-unit {
            flex: 1;
        }
        
        .time-value {
            font-size: 32px;
            font-weight: bold;
            color: #e94560;
            background-color: rgba(22, 33, 62, 0.8);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 5px;
        }
        
        .time-label {
            font-size: 12px;
            color: #a9b7d0;
            text-transform: uppercase;
        }
        
        .track-info {
            padding: 15px 20px;
            text-align: center;
            font-size: 14px;
            color: #a9b7d0;
            border-bottom: 1px solid #2d3749;
        }
        
        .track-date {
            color: #e94560;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .actions {
            display: flex;
            padding: 15px 20px;
            justify-content: center;
            border-bottom: 1px solid #2d3749;
        }
        
        .action-btn {
            background-color: #0f3460;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: bold;
            margin: 0 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background-color: #e94560;
        }
        
        .challenges {
            padding: 20px;
        }
        
        .challenge-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #e94560;
        }
        
        .challenge-item {
            margin-bottom: 20px;
        }
        
        .challenge-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .challenge-name {
            font-size: 14px;
            color: #a9b7d0;
        }
        
        .challenge-percent {
            font-size: 14px;
            color: #e94560;
            font-weight: bold;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #2d3749;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #e94560;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .panic-section {
            padding: 15px 20px;
            text-align: center;
            border-top: 1px solid #2d3749;
            border-bottom: 1px solid #2d3749;
        }
        
        .panic-btn {
            background-color: #e94560;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .panic-btn:hover {
            background-color: #ff6b81;
            transform: scale(1.05);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #16213e;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }
        
        .modal h3 {
            margin-bottom: 15px;
            color: #e94560;
        }
        
        .modal p {
            margin-bottom: 20px;
            color: #a9b7d0;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: space-between;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .modal-confirm {
            background-color: #e94560;
            color: white;
        }
        
        .modal-cancel {
            background-color: #2d3749;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">QUITBRO</div>
        </div>
        
        <div class="timer-section">
            <div class="timer">
                <div class="time-unit">
                    <div class="time-value" id="days">00</div>
                    <div class="time-label">days</div>
                </div>
                <div class="time-unit">
                    <div class="time-value" id="hours">00</div>
                    <div class="time-label">hours</div>
                </div>
                <div class="time-unit">
                    <div class="time-value" id="minutes">00</div>
                    <div class="time-label">minutes</div>
                </div>
                <div class="time-unit">
                    <div class="time-value" id="seconds">00</div>
                    <div class="time-label">seconds</div>
                </div>
            </div>
        </div>
        
        <div class="track-info">
            You're on track to quit by:<br>
            <div class="track-date" id="quit-date">--</div>
        </div>
        
        <div class="actions">
            <button class="action-btn" id="reset-btn">Reset</button>
        </div>
        
        <div class="challenges">
            <div class="challenge-title">Recovery Challenges</div>
            <div class="challenge-item">
                <div class="challenge-header">
                    <div class="challenge-name">First 21 Day Challenge</div>
                    <div class="challenge-percent" id="challenge-21-percent">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="challenge-21-progress" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="challenge-item">
                <div class="challenge-header">
                    <div class="challenge-name">Brain Rewiring (90 Days)</div>
                    <div class="challenge-percent" id="challenge-brain-percent">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="challenge-brain-progress" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <div class="panic-section">
            <button class="panic-btn" id="panic-btn">Panic Button</button>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal" id="reset-modal">
        <div class="modal-content">
            <h3>Reset Your Progress?</h3>
            <p>Are you sure you want to reset your progress? This will set your timer back to 0 days.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-cancel" id="cancel-reset">Cancel</button>
                <button class="modal-btn modal-confirm" id="confirm-reset">Reset</button>
            </div>
        </div>
    </div>

    <!-- Panic Help Modal -->
    <div class="modal" id="panic-modal">
        <div class="modal-content">
            <h3>Need Help Right Now?</h3>
            <p>Take a deep breath. You can get through this craving.</p>
            <p><strong>Try these immediately:</strong></p>
            <ul style="text-align: left; margin: 15px 0; color: #a9b7d0;">
                <li>Drink a glass of cold water</li>
                <li>Do 10 push-ups or jumping jacks</li>
                <li>Call a supportive friend</li>
                <li>Take a 5-minute walk outside</li>
                <li>Practice deep breathing for 2 minutes</li>
            </ul>
            <div class="modal-buttons">
                <button class="modal-btn modal-confirm" id="close-panic">I'll Try This</button>
            </div>
        </div>
    </div>

    <script>
        // User data management - FIXED VERSION
        function getUserData() {
            const savedData = localStorage.getItem('quitbro-user-data');
            if (savedData) {
                return JSON.parse(savedData);
            } else {
                // Initialize with current date and time
                const startDate = new Date();
                return {
                    startDate: startDate.getTime(), // Store as timestamp
                    totalSeconds: 0
                };
            }
        }
        
        function saveUserData(data) {
            localStorage.setItem('quitbro-user-data', JSON.stringify(data));
        }
        
        // Calculate time passed since start
        function calculateTimePassed(startTimestamp) {
            const now = Date.now();
            const elapsedSeconds = Math.floor((now - startTimestamp) / 1000);
            return elapsedSeconds;
        }
        
        // Convert total seconds to days, hours, minutes, seconds
        function secondsToTime(totalSeconds) {
            const days = Math.floor(totalSeconds / (24 * 60 * 60));
            const hours = Math.floor((totalSeconds % (24 * 60 * 60)) / (60 * 60));
            const minutes = Math.floor((totalSeconds % (60 * 60)) / 60);
            const seconds = totalSeconds % 60;
            
            return { days, hours, minutes, seconds };
        }
        
        // Timer functionality - FIXED VERSION
        let userData = getUserData();
        let totalSeconds = userData.totalSeconds;
        let timerInterval;
        
        function startTimer() {
            // Calculate actual time passed since start
            const actualSecondsPassed = calculateTimePassed(userData.startDate);
            
            // Use whichever is larger - our stored time or actual time passed
            totalSeconds = Math.max(totalSeconds, actualSecondsPassed);
            
            // Update display immediately
            updateDisplay();
            
            // Start counting
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function updateTimer() {
            totalSeconds++;
            
            // Update the display
            updateDisplay();
            
            // Update progress bars
            updateProgress();
            
            // Save current state
            userData.totalSeconds = totalSeconds;
            saveUserData(userData);
        }
        
        function updateDisplay() {
            const time = secondsToTime(totalSeconds);
            
            document.getElementById('seconds').textContent = time.seconds.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = time.minutes.toString().padStart(2, '0');
            document.getElementById('hours').textContent = time.hours.toString().padStart(2, '0');
            document.getElementById('days').textContent = time.days.toString().padStart(2, '0');
            
            // Update quit date (3 months from start)
            const startDate = new Date(userData.startDate);
            const quitDate = new Date(startDate);
            quitDate.setMonth(quitDate.getMonth() + 3);
            document.getElementById('quit-date').textContent = formatDate(quitDate);
        }
        
        function formatDate(date) {
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
            return ${date.getDate()} ${months[date.getMonth()]}, ${date.getFullYear()};
        }
        
        // Update progress bars based on days
        function updateProgress() {
            const time = secondsToTime(totalSeconds);
            const days = time.days;
            
            // 21-day challenge progress
            const progress21 = Math.min(100, Math.floor((days / 21) * 100));
            document.getElementById('challenge-21-progress').style.width = ${progress21}%;
            document.getElementById('challenge-21-percent').textContent = ${progress21}%;
            
            // Brain rewiring progress (90 days)
            const progressBrain = Math.min(100, Math.floor((days / 90) * 100));
            document.getElementById('challenge-brain-progress').style.width = ${progressBrain}%;
            document.getElementById('challenge-brain-percent').textContent = ${progressBrain}%;
        }
        
        // Reset functionality
        document.getElementById('reset-btn').addEventListener('click', function() {
            document.getElementById('reset-modal').style.display = 'flex';
        });
        
        document.getElementById('cancel-reset').addEventListener('click', function() {
            document.getElementById('reset-modal').style.display = 'none';
        });
        
        document.getElementById('confirm-reset').addEventListener('click', function() {
            // Reset everything
            const startDate = new Date();
            userData = {
                startDate: startDate.getTime(),
                totalSeconds: 0
            };
            totalSeconds = 0;
            
            saveUserData(userData);
            updateDisplay();
            updateProgress();
            
            document.getElementById('reset-modal').style.display = 'none';
        });
        
        // Panic button functionality
        document.getElementById('panic-btn').addEventListener('click', function() {
            document.getElementById('panic-modal').style.display = 'flex';
        });
        
        document.getElementById('close-panic').addEventListener('click', function() {
            document.getElementById('panic-modal').style.display = 'none';
        });
        
        // Start the timer when page loads
        document.addEventListener('DOMContentLoaded', function() {
            startTimer();
        });
    </script>
</body>
</html>
